<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dipesh Cloud Drive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="favi.png">
    
    <style>
        /* --- CSS STYLES --- */
        :root { --primary: #4f46e5; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --danger: #ef4444; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg); color: var(--text); min-height: 100vh; }

        /* Login Screen */
        #auth-screen { display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .login-card { background: rgba(255, 255, 255, 0.98); padding: 3rem; border-radius: 1.5rem; text-align: center; width: 100%; max-width: 420px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .google-btn { background: white; color: #333; border: 1px solid #ddd; padding: 12px; border-radius: 50px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; margin-top: 25px; transition: 0.3s; }
        .google-btn:hover { background: #f1f5f9; transform: translateY(-2px); }

        /* Dashboard & Navbar */
        #dashboard-screen { display: none; }
        nav { background: var(--card); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 50; }
        
        /* User Profile Section */
        .user-profile { display: flex; align-items: center; gap: 12px; }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); }
        .user-info h4 { font-size: 0.95rem; font-weight: 700; color: var(--text); }
        .user-info p { font-size: 0.8rem; color: #64748b; }
        .btn-logout { background: #fee2e2; color: var(--danger); border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; margin-left: 15px; transition: 0.2s; }
        .btn-logout:hover { background: var(--danger); color: white; }

        /* Categories & Toolbar */
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; }
        
        .category-bar { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .cat-btn { background: white; border: 1px solid #e2e8f0; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .cat-btn.active, .cat-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-upload { background: var(--primary); color: white; padding: 12px 28px; border-radius: 12px; cursor: pointer; border: none; font-weight: bold; font-size: 1rem; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); transition: 0.3s; }
        .btn-upload:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(79, 70, 229, 0.4); }

        /* Files Grid */
        .files-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 1.5rem; }
        .file-card { background: var(--card); border-radius: 16px; padding: 1rem; border: 1px solid #f1f5f9; text-align: center; position: relative; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .file-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .file-card img { width: 100%; height: 110px; object-fit: cover; border-radius: 10px; margin-bottom: 12px; }
        .file-icon { font-size: 50px; color: #94a3b8; margin: 30px 0; display: block; }
        .file-name { font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #334155; }
        .file-meta { font-size: 0.75rem; color: #94a3b8; margin-top: 5px; }

        .delete-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: 1px solid #ef4444; color: #ef4444; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.2s; }
        .file-card:hover .delete-btn { opacity: 1; }
        .delete-btn:hover { background: #ef4444; color: white; }

        /* Loader */
        #loader { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader"><div class="spinner"></div><p id="loader-text" style="margin-top: 15px; font-weight: 600; color: var(--primary);">Loading...</p></div>

    <div id="auth-screen">
        <div class="login-card">
            <h1 style="color: var(--primary); margin-bottom: 10px;"><i class="fas fa-cloud-upload-alt"></i> Dipesh Drive</h1>
            <p style="color: #64748b;">Secure & Smart Cloud Storage</p>
            <button class="google-btn" onclick="handleAuth()">
    <img src="https://fonts.gstatic.com/s/i/productlogos/googleg/v6/24px.svg" width="24" alt="Google Logo" style="margin-right: 10px;"> 
    Sign in with Google
</button>
        </div>
    </div>

    <div id="dashboard-screen">
        <nav>
            <div style="font-size: 1.4rem; font-weight: 800; color: var(--primary);">
                <i class="fab fa-google-drive"></i> Dipesh Drive
            </div>
            
            <div class="user-profile" id="user-profile-display">
                </div>
        </nav>

        <div class="container">
            <div class="category-bar">
                <button class="cat-btn active" onclick="filterFiles('all', this)"><i class="fas fa-th-large"></i> All Files</button>
                <button class="cat-btn" onclick="filterFiles('image', this)"><i class="fas fa-image"></i> Images</button>
                <button class="cat-btn" onclick="filterFiles('video', this)"><i class="fas fa-video"></i> Videos</button>
                <button class="cat-btn" onclick="filterFiles('pdf', this)"><i class="fas fa-file-pdf"></i> PDFs</button>
            </div>

            <div class="toolbar">
                <h3 style="color: var(--text);">Recent Uploads</h3>
                <input type="file" id="fileInput" style="display: none;" onchange="uploadFile(this)">
                <button class="btn-upload" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-plus"></i> Upload New
                </button>
            </div>

            <div class="files-grid" id="file-list"></div>
        </div>
    </div>

    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    <script>
        // --- ðŸ”´ SETUP: API KEYS (PASTE YOUR KEYS HERE) ðŸ”´ ---
        const CLIENT_ID = '649643839904-4ennmi503qot0ak8v9eovsv0p9rdr63i.apps.googleusercontent.com'; 
        const API_KEY = 'AIzaSyBTgEkBqYYPPuiJa-HWBeqWQbT7GdhHH9U'; 
        // -----------------------------------------------------

        // Added 'email' and 'profile' to scopes to get user info
        const SCOPES = 'https://www.googleapis.com/auth/drive.file email profile';
        const MAIN_FOLDER_NAME = "My_Cloud_App";

        let tokenClient;
        let allFiles = []; // Store files globally for filtering

        function gapiLoaded() { gapi.load('client', async () => {
            await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"] });
        }); }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: SCOPES, callback: '' });
        }

        function handleAuth() {
            tokenClient.callback = async (resp) => {
                if (resp.error) throw (resp);
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('dashboard-screen').style.display = 'block';
                
                // Get User Info & Files
                await fetchUserInfo(resp.access_token);
                await listFiles();
            };
            // Request token (if existing token is null)
            tokenClient.requestAccessToken({prompt: 'consent'});
        }

        // --- ðŸ‘¤ FETCH USER INFO ---
        async function fetchUserInfo(accessToken) {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const user = await response.json();
                
                // Update HTML
                const profileHTML = `
                    <div class="user-info" style="text-align:right;">
                        <h4>${user.name}</h4>
                        <p>${user.email}</p>
                    </div>
                    <img src="${user.picture}" class="user-avatar" alt="User">
                    <button class="btn-logout" onclick="handleSignout()"><i class="fas fa-sign-out-alt"></i></button>
                `;
                document.getElementById('user-profile-display').innerHTML = profileHTML;
            } catch (error) {
                console.error("Error fetching user info", error);
            }
        }

        function handleSignout() {
            const token = gapi.client.getToken();
            if (token !== null) {
                google.accounts.oauth2.revoke(token.access_token);
                gapi.client.setToken('');
                location.reload(); // Simple reload to clear state
            }
        }

        // --- ðŸ“‚ SMART UPLOAD LOGIC ---
        async function getOrCreateFolder(folderName, parentId = 'root') {
            const query = `mimeType='application/vnd.google-apps.folder' and name='${folderName}' and '${parentId}' in parents and trashed=false`;
            const response = await gapi.client.drive.files.list({ q: query, fields: 'files(id, name)' });
            
            if (response.result.files.length > 0) return response.result.files[0].id;
            
            const folder = await gapi.client.drive.files.create({
                resource: { 'name': folderName, 'mimeType': 'application/vnd.google-apps.folder', 'parents': [parentId] },
                fields: 'id'
            });
            return folder.result.id;
        }

        async function uploadFile(input) {
            const file = input.files[0];
            if (!file) return;
            showLoader(true, "Sorting & Uploading...");

            try {
                const mainFolderId = await getOrCreateFolder(MAIN_FOLDER_NAME);
                
                let subFolderName = "Others";
                if (file.type.startsWith("image/")) subFolderName = "Images";
                else if (file.type === "application/pdf") subFolderName = "PDFs";
                else if (file.type.startsWith("video/")) subFolderName = "Videos";

                const targetFolderId = await getOrCreateFolder(subFolderName, mainFolderId);

                const metadata = { 'name': file.name, 'mimeType': file.type, 'parents': [targetFolderId] };
                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + gapi.client.getToken().access_token }),
                    body: form
                });

                alert("Uploaded!");
                listFiles(); 

            } catch (e) { alert("Upload failed"); console.error(e); }
            input.value = '';
            showLoader(false);
        }

        // --- ðŸ“‹ LIST & FILTER FILES ---
        async function listFiles() {
            showLoader(true, "Fetching files...");
            try {
                const response = await gapi.client.drive.files.list({
                    'pageSize': 100,
                    'fields': "files(id, name, mimeType, thumbnailLink, webViewLink, createdTime)",
                    'q': "trashed=false and mimeType != 'application/vnd.google-apps.folder'"
                });
                allFiles = response.result.files || [];
                renderFiles(allFiles); // Initial render (all)
            } catch (err) { console.error(err); }
            showLoader(false);
        }

        function filterFiles(type, btn) {
            // Update active button style
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            if (type === 'all') {
                renderFiles(allFiles);
            } else {
                // Filter logic
                const filtered = allFiles.filter(file => file.mimeType.toLowerCase().includes(type));
                renderFiles(filtered);
            }
        }

        function renderFiles(files) {
            const grid = document.getElementById('file-list');
            grid.innerHTML = '';
            
            if (files.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center; color:#999;">No files found in this category.</p>';
                return;
            }

            files.forEach(file => {
                let isImg = file.mimeType.includes('image') && file.thumbnailLink;
                let thumb = isImg ? file.thumbnailLink.replace('s220', 's600') : ''; // High res thumb
                
                // Determine Icon
                let icon = '<i class="fas fa-file"></i>';
                if (file.mimeType.includes('pdf')) icon = '<i class="fas fa-file-pdf" style="color:#ef4444"></i>';
                else if (file.mimeType.includes('video')) icon = '<i class="fas fa-video" style="color:#3b82f6"></i>';
                else if (file.mimeType.includes('image')) icon = '<i class="fas fa-image" style="color:#10b981"></i>';

                let displayContent = isImg ? `<img src="${thumb}">` : `<div class="file-icon">${icon}</div>`;

                grid.innerHTML += `
                    <div class="file-card">
                        <button class="delete-btn" onclick="deleteFile('${file.id}')"><i class="fas fa-trash"></i></button>
                        <a href="${file.webViewLink}" target="_blank" style="text-decoration:none;">
                            ${displayContent}
                            <div class="file-name" title="${file.name}">${file.name}</div>
                            <div class="file-meta">${new Date(file.createdTime).toLocaleDateString()}</div>
                        </a>
                    </div>
                `;
            });
        }

        async function deleteFile(id) {
            if(!confirm("Are you sure you want to delete this?")) return;
            showLoader(true, "Deleting...");
            try {
                await gapi.client.drive.files.delete({ 'fileId': id });
                await listFiles(); // Refresh list
            } catch (e) { alert("Delete failed"); }
            showLoader(false);
        }

        function showLoader(show, text) {
            document.getElementById('loader').style.display = show ? 'flex' : 'none';
            if(text) document.getElementById('loader-text').innerText = text;
        }

        // Disable right-click
document.addEventListener('contextmenu', (e) => e.preventDefault());

function ctrlShiftKey(e, keyCode) {
  return e.ctrlKey && e.shiftKey && e.keyCode === keyCode.charCodeAt(0);
}

document.onkeydown = (e) => {
  // Disable F12, Ctrl + Shift + I, Ctrl + Shift + J, Ctrl + U
  if (
    event.keyCode === 123 ||
    ctrlShiftKey(e, 'I') ||
    ctrlShiftKey(e, 'J') ||
    ctrlShiftKey(e, 'C') ||
    (e.ctrlKey && e.keyCode === 'U'.charCodeAt(0))
  )
    return false;
};

        
    </script>
</body>

</html>


